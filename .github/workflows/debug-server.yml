name: Debug Server Status

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: SSH Debug Commands
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            echo "--- ğŸ” Checking Active Ports ---"
            sudo netstat -tuln
            
            echo "--- ğŸ” Checking Nginx Status ---"
            sudo systemctl status nginx --no-pager
            
            echo "--- ğŸ” Checking Apache Status (Should be Dead) ---"
            sudo systemctl status apache2 --no-pager || echo "Apache is not running (Good)"
            
            echo "--- ğŸ” Checking Connectivity (HTTP) ---"
            curl -I http://localhost || echo "HTTP Fail"
            
            echo "--- ğŸ” Checking Connectivity (HTTPS via IP) ---"
            curl -I -k https://127.0.0.1/api/products || echo "HTTPS Fail"

            echo "--- ğŸ” Checking Docker Logs (Frontend) ---"
            docker logs --tail 20 pi_prod_frontend
