<VirtualHost *:80>
    ServerName app.alberoperez.tech
    ServerAdmin webmaster@localhost
    DocumentRoot /home/app/ftp/www

    # Redirección HTTP -> HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    ErrorLog /home/app/logs/error.log
    CustomLog /home/app/logs/access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName app.alberoperez.tech
    DocumentRoot /home/app/ftp/www

    # Proxy para el Backend (API)
    ProxyPreserveHost On
    ProxyPass /api http://127.0.0.1:3000
    ProxyPassReverse /api http://127.0.0.1:3000

    DocumentRoot /home/app/ftp/www

    SSLEngine on
    # La rutas de los certificados serán generadas por Certbot
    # SSLCertificateFile /etc/letsencrypt/live/.../fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/.../privkey.pem

    <Directory /home/app/ftp/www>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog /home/app/logs/error_ssl.log
    CustomLog /home/app/logs/access_ssl.log combined
</VirtualHost>
